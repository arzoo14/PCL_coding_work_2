

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>The OpenNI Grabber Framework in PCL &mdash; PCL DOCUMENTATION 0.0.1 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
        <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: dark blue" >
          

          
            <a href="index.html" class="icon icon-home"> PCL DOCUMENTATION
          

          
          </a>

          
            
            
              <div class="version">
                0.0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Basic Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="walkthrough.html">1. PCL Walkthrough</a></li>
<li class="toctree-l1"><a class="reference internal" href="basic_structures.html">2. Getting Started / Basic Structures</a></li>
<li class="toctree-l1"><a class="reference internal" href="using_pcl_pcl_config.html">3. Using PCL in your own project</a></li>
<li class="toctree-l1"><a class="reference internal" href="compiling_pcl_posix.html">4. Compiling PCL from source on POSIX compliant systems</a></li>
<li class="toctree-l1"><a class="reference internal" href="building_pcl.html">5. Customizing the PCL build process</a></li>
<li class="toctree-l1"><a class="reference internal" href="compiling_pcl_dependencies_windows.html">6. Building PCL’s dependencies from source on Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="compiling_pcl_windows.html">7. Compiling PCL from source on Windows</a></li>
<li class="toctree-l1"><a class="reference internal" href="compiling_pcl_macosx.html">8. Compiling PCL and its dependencies from MacPorts and source on Mac OS X</a></li>
<li class="toctree-l1"><a class="reference internal" href="installing_homebrew.html">9. Installing on Mac OS X using Homebrew</a></li>
<li class="toctree-l1"><a class="reference internal" href="using_pcl_with_eclipse.html">10. Using PCL with Eclipse</a></li>
<li class="toctree-l1"><a class="reference internal" href="generate_local_doc.html">11. Generate a local documentation for PCL</a></li>
<li class="toctree-l1"><a class="reference internal" href="matrix_transform.html">12. Using a matrix to transform a point cloud</a></li>
</ul>
<p class="caption"><span class="caption-text">Advanced Usage</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="adding_custom_ptype.html">1. Adding your own custom <cite>PointT</cite> type</a></li>
<li class="toctree-l1"><a class="reference internal" href="writing_new_classes.html">2. Writing a new PCL class</a></li>
</ul>
<p class="caption"><span class="caption-text">Features</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="how_features_work.html">1. How 3D Features work in PCL</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">PCL DOCUMENTATION</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>The OpenNI Grabber Framework in PCL</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/openni_grabber.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="the-openni-grabber-framework-in-pcl">
<span id="openni-grabber"></span><h1>The OpenNI Grabber Framework in PCL<a class="headerlink" href="#the-openni-grabber-framework-in-pcl" title="Permalink to this headline">¶</a></h1>
<p>As of PCL 1.0, we offer a new generic grabber interface to provide a smooth and
convenient access to different devices and their drivers, file formats and
other sources of data.</p>
<p>The first driver that we incorporated is the new OpenNI Grabber, which makes it
a breeze to request data streams from OpenNI compatible cameras. This tutorial
presents how to set up and use the grabber, and since it’s so simple, we can
keep it short :).</p>
<p>The cameras that we have tested so far are the <a class="reference external" href="http://www.primesense.com/">Primesense Reference Design</a>, <a class="reference external" href="http://www.xbox.com/kinect/">Microsoft Kinect</a> and <a class="reference external" href="http://event.asus.com/wavi/product/WAVI_Pro.aspx">Asus Xtion Pro</a> cameras:</p>
<a class="reference internal image-reference" href="_images/openni_cams.jpg"><img alt="_images/openni_cams.jpg" src="_images/openni_cams.jpg" style="height: 390px;" /></a>
</div>
<div class="section" id="simple-example">
<h1>Simple Example<a class="headerlink" href="#simple-example" title="Permalink to this headline">¶</a></h1>
<p>In <em>visualization</em>, there is a very short piece of code which contains all that
is required to set up a <em>pcl::PointCloud&lt;XYZ&gt;</em> or <em>pcl::PointCloud&lt;XYZRGB&gt;</em>
cloud callback.</p>
<p>Here is a screenshot and a video of the PCL OpenNI Viewer in action, which uses
the OpenNI Grabber.</p>
<a class="reference external image-reference" href="_images/pcl_openni_viewer.jpg"><img alt="_images/pcl_openni_viewer.jpg" src="_images/pcl_openni_viewer.jpg" style="height: 390px;" /></a>
<iframe title="PCL OpenNI Viewer example" width="480" height="390" src="http://www.youtube.com/embed/x3SaWQkPsPI?rel=0" frameborder="0" allowfullscreen></iframe><p>So let’s look at the code. From <em>visualization/tools/openni_viewer_simple.cpp</em></p>
<div class="highlight-cpp notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42</pre></div></td><td class="code"><div class="highlight"><pre><span></span> <span class="cp">#include</span> <span class="cpf">&lt;pcl/io/openni_grabber.h&gt;</span><span class="cp"></span>
 <span class="cp">#include</span> <span class="cpf">&lt;pcl/visualization/cloud_viewer.h&gt;</span><span class="cp"></span>

 <span class="k">class</span> <span class="nc">SimpleOpenNIViewer</span>
 <span class="p">{</span>
   <span class="k">public</span><span class="o">:</span>
     <span class="n">SimpleOpenNIViewer</span> <span class="p">()</span> <span class="o">:</span> <span class="n">viewer</span> <span class="p">(</span><span class="s">&quot;PCL OpenNI Viewer&quot;</span><span class="p">)</span> <span class="p">{}</span>

     <span class="kt">void</span> <span class="n">cloud_cb_</span> <span class="p">(</span><span class="k">const</span> <span class="n">pcl</span><span class="o">::</span><span class="n">PointCloud</span><span class="o">&lt;</span><span class="n">pcl</span><span class="o">::</span><span class="n">PointXYZ</span><span class="o">&gt;::</span><span class="n">ConstPtr</span> <span class="o">&amp;</span><span class="n">cloud</span><span class="p">)</span>
     <span class="p">{</span>
       <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">viewer</span><span class="p">.</span><span class="n">wasStopped</span><span class="p">())</span>
         <span class="n">viewer</span><span class="p">.</span><span class="n">showCloud</span> <span class="p">(</span><span class="n">cloud</span><span class="p">);</span>
     <span class="p">}</span>

     <span class="kt">void</span> <span class="n">run</span> <span class="p">()</span>
     <span class="p">{</span>
       <span class="n">pcl</span><span class="o">::</span><span class="n">Grabber</span><span class="o">*</span> <span class="n">interface</span> <span class="o">=</span> <span class="k">new</span> <span class="n">pcl</span><span class="o">::</span><span class="n">OpenNIGrabber</span><span class="p">();</span>

       <span class="n">std</span><span class="o">::</span><span class="n">function</span><span class="o">&lt;</span><span class="kt">void</span> <span class="p">(</span><span class="k">const</span> <span class="n">pcl</span><span class="o">::</span><span class="n">PointCloud</span><span class="o">&lt;</span><span class="n">pcl</span><span class="o">::</span><span class="n">PointXYZ</span><span class="o">&gt;::</span><span class="n">ConstPtr</span><span class="o">&amp;</span><span class="p">)</span><span class="o">&gt;</span> <span class="n">f</span> <span class="o">=</span>
         <span class="p">[</span><span class="k">this</span><span class="p">]</span> <span class="p">(</span><span class="k">const</span> <span class="n">pcl</span><span class="o">::</span><span class="n">PointCloud</span><span class="o">&lt;</span><span class="n">pcl</span><span class="o">::</span><span class="n">PointXYZ</span><span class="o">&gt;::</span><span class="n">ConstPtr</span><span class="o">&amp;</span> <span class="n">cloud</span><span class="p">)</span> <span class="p">{</span> <span class="n">cloud_cb_</span> <span class="p">(</span><span class="n">cloud</span><span class="p">);</span> <span class="p">};</span>

       <span class="n">interface</span><span class="o">-&gt;</span><span class="n">registerCallback</span> <span class="p">(</span><span class="n">f</span><span class="p">);</span>

       <span class="n">interface</span><span class="o">-&gt;</span><span class="n">start</span> <span class="p">();</span>

       <span class="k">while</span> <span class="p">(</span><span class="o">!</span><span class="n">viewer</span><span class="p">.</span><span class="n">wasStopped</span><span class="p">())</span>
       <span class="p">{</span>
         <span class="n">boost</span><span class="o">::</span><span class="n">this_thread</span><span class="o">::</span><span class="n">sleep</span> <span class="p">(</span><span class="n">boost</span><span class="o">::</span><span class="n">posix_time</span><span class="o">::</span><span class="n">seconds</span> <span class="p">(</span><span class="mi">1</span><span class="p">));</span>
       <span class="p">}</span>

       <span class="n">interface</span><span class="o">-&gt;</span><span class="n">stop</span> <span class="p">();</span>
     <span class="p">}</span>

     <span class="n">pcl</span><span class="o">::</span><span class="n">visualization</span><span class="o">::</span><span class="n">CloudViewer</span> <span class="n">viewer</span><span class="p">;</span>
 <span class="p">};</span>

 <span class="kt">int</span> <span class="nf">main</span> <span class="p">()</span>
 <span class="p">{</span>
   <span class="n">SimpleOpenNIViewer</span> <span class="n">v</span><span class="p">;</span>
   <span class="n">v</span><span class="p">.</span><span class="n">run</span> <span class="p">();</span>
   <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
 <span class="p">}</span>
</pre></div>
</td></tr></table></div>
<p>As you can see, the <em>run ()</em> function of <em>SimpleOpenNIViewer</em> first creates a
new <em>OpenNIGrabber</em> interface. The next line might seem a bit intimidating at
first, but it’s not that bad. We create a lambda object which invokes <em>cloud_cb_</em>,
we capture a copy of <em>this</em> to get an pointer to our <em>SimpleOpenNIViewer</em>, so
that <em>cloud_cb_</em> can be invoked.</p>
<p>The lambda then gets casted to a <em>std::function</em> object which is templated on
the callback function type, in this case <em>void (const
pcl::PointCloud&lt;pcl::PointXYZ&gt;::ConstPtr&amp;)</em>. The resulting function object can
the be registered with the <em>OpenNIGrabber</em> and subsequently started.  Note that
the <em>stop ()</em> method does not necessarily need to be called, as the destructor
takes care of that.</p>
</div>
<div class="section" id="additional-details">
<h1>Additional Details<a class="headerlink" href="#additional-details" title="Permalink to this headline">¶</a></h1>
<p>The <em>OpenNIGrabber</em> offers more than one datatype, which is the reason we made
the <em>Grabber</em> interface so generic, leading to the relatively complicated
lambda line. In fact, we can register the following callback types as of
this writing:</p>
<ul>
<li><p><cite>void (const pcl::PointCloud&lt;pcl::PointXYZRGB&gt;::ConstPtr&amp;)</cite></p></li>
<li><p><cite>void (const pcl::PointCloud&lt;pcl::PointXYZ&gt;::ConstPtr&amp;)</cite></p></li>
<li><p><cite>void (const openni_wrapper::Image::Ptr&amp;)</cite></p>
<p>This provides just the RGB image from the built-in camera.</p>
</li>
<li><p><cite>void (const openni_wrapper::DepthImage::Ptr&amp;)</cite></p>
<p>This provides the depth image, without any color or intensity information</p>
</li>
<li><p><cite>void (const openni_wrapper::Image::Ptr&amp;, const openni_wrapper::DepthImage::Ptr&amp;, float constant)</cite></p>
<p>When a callback of this type is registered, the grabber sends both RGB
image and depth image and the constant (<em>1 / focal length</em>), which you need
if you want to do your own disparity conversion.</p>
</li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>All callback types that need a depth _and_ image stream have a
synchronization mechanism enabled which ensures consistent depth and image
data. This introduces a small lag, since the synchronizer needs to wait at
least for one more set of images before sending the first ones.</p>
</div>
</div>
<div class="section" id="starting-and-stopping-streams">
<h1>Starting and stopping streams<a class="headerlink" href="#starting-and-stopping-streams" title="Permalink to this headline">¶</a></h1>
<p>The <em>registerCallback</em> call returns a <em>boost::signals2::connection</em> object,
which we ignore in the above example. However, if you want to interrupt or
cancel one or more of the registered data streams, you can call disconnect the
callback without stopping the whole grabber:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">boost</span><span class="o">::</span><span class="n">signals2</span><span class="o">::</span><span class="n">connection</span> <span class="o">=</span> <span class="n">interface</span> <span class="p">(</span><span class="n">registerCallback</span> <span class="p">(</span><span class="n">f</span><span class="p">));</span>

<span class="c1">// ...</span>

<span class="k">if</span> <span class="p">(</span><span class="n">c</span><span class="p">.</span><span class="n">connected</span> <span class="p">())</span>
  <span class="n">c</span><span class="p">.</span><span class="n">disconnect</span> <span class="p">();</span>
</pre></div>
</div>
</div>
<div class="section" id="benchmark">
<h1>Benchmark<a class="headerlink" href="#benchmark" title="Permalink to this headline">¶</a></h1>
<p>The following code snippet will attempt to subscribe to both the <em>depth</em> and
<em>color</em> streams, and is provided as a way to benchmark your system. If your
computer is too slow, and you might not be able to get ~29Hz+, please contact
us. We might be able to optimize the code even further.</p>
</div>
<div class="section" id="compiling-and-running-the-program">
<h1>Compiling and running the program<a class="headerlink" href="#compiling-and-running-the-program" title="Permalink to this headline">¶</a></h1>
<p>Add the following lines to your CMakeLists.txt file:</p>
</div>
<div class="section" id="troubleshooting">
<h1>Troubleshooting<a class="headerlink" href="#troubleshooting" title="Permalink to this headline">¶</a></h1>
<p>Q: I get an error that there’s no device connected:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>[OpenNIGrabber] No devices connected.
terminate called after throwing an instance of ‘pcl::PCLIOException’
what():  pcl::OpenNIGrabber::OpenNIGrabber(const std::string&amp;) in openni_grabber.cpp &#64; 69: Device could not be initialized or no devices found.
[1]    8709 abort      openni_viewer</p>
</div>
<p>A: most probably this is a problem with the XnSensorServer. Do you have the
ps-engine package installed? Is there a old process of XnSensorServer hanging
around, try kill it.</p>
<p>Q: I get an error about a closed network connection:</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>terminate called after throwing an instance of ‘pcl::PCLIOException’
what():  No matching device found. openni_wrapper::OpenNIDevice::OpenNIDevice(xn::Context&amp;, const xn::NodeInfo&amp;, const xn::NodeInfo&amp;, const xn::NodeInfo&amp;, const xn::NodeInfo&amp;) &#64; /home/andreas/pcl/pcl/trunk/io/src/openni_camera/openni_device.cpp &#64; 96 : creating depth generator failed. Reason: The network connection has been closed!</p>
</div>
<p>A: This error can occur with newer Linux kernels that include the <em>gspca_kinect</em> kernel module. The module claims the usb interface of the kinect and prevents OpenNI from doing so.
You can either remove the kernel module (<em>rmmod gspca_kinect</em>) or blacklist it (by executing <em>echo “blacklist gspca_kinect” &gt; /etc/modprobe.d/blacklist-psengine.conf</em> as root).
The OpenNI Ubuntu packages provided by PCL already include this fix, but you might need it in other distributions.</p>
</div>
<div class="section" id="conclusion">
<h1>Conclusion<a class="headerlink" href="#conclusion" title="Permalink to this headline">¶</a></h1>
<p>The Grabber interface is very powerful and general and makes it a breeze to
connect to OpenNI compatible cameras in your code. We are in the process of
writing a FileGrabber which can be used using the same interface, and can e.g.
load all Point Cloud files from a directory and provide them to the callback at
a certain rate. The only change required is
the allocation of the Grabber Object (<em>pcl::Grabber *g = new …;</em>).</p>
<p>If you have a sensor which you would like to have available within PCL, just
let us know at <em>pcl-developers&#64;pointclouds.org</em>, and we will figure something
out.</p>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020, Arzoo

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
    <!-- Theme Analytics -->
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

    ga('create', 'UA-XXXXXXX-1', 'auto');
    ga('send', 'pageview');
    </script>

    
   

</body>
</html>